<html>

<canvas id="myCanvas" style="height:100%; width:100%;">
</canvas>

<script>
    function paintArray(canvas, array) {
        let ctx = canvas.getContext("2d");

        for (let [i, num] of Object.entries(array)) {
            ctx.rect(20 + i * 20, 20, 5, 5 * num);
            ctx.stroke();
        }
    }

    function sleep(time) {
        return new Promise((resolve) => {
            setTimeout(resolve, time);
        })
    }

    function InsertionSort(array) {
        let sortedArray = [];
        for (let i = 0; i < array.length; i++) { // n
            // console.log(sortedArray, array[i]);
            sortedArray = insert(sortedArray, array[i]);
        }
        return sortedArray;
    }

    // 10K
    function insert(array, number) {
        // [1, 2, 4, 5], 3
        // in-place
        // immutable 不可变
        if (array.length === 0) {
            return [number];
        }
        let sorted = [];
        let inserted = false;
        for (let i = 0; i < array.length; i++) { // n
            if (!inserted) {
                if (number < array[i]) {
                    inserted = true;
                    sorted.push(number);
                }
            }
            sorted.push(array[i]);
        }
        if (!inserted) {
            sorted.push(number);
        }
        return sorted;
    }

    class ArrayViewModel extends Array {

        constructor() {
            super(arguments[0]);
            this.paintArray = arguments[1];
        }

        push(number) {
            super.push(number);
            this.paintArray(this);
        }

    }

    async function main() {
        let c = document.getElementById("myCanvas");
        // InsertionSort(new ArrayViewModel([3,4,2,5,1]));
        
        let array = new ArrayViewModel([], (a) => { return paintArray(c, a) });
        for (let i = 0; i < 10; i++) {
            await sleep(1000);
            array.push(i);
        }
    }
    main();
</script>

</html>